import { jsonToCSV, readRemoteFile } from 'react-native-csv';
import * as FileSystem from 'expo-file-system';
import * as Permissions from 'expo-permissions';
import * as MediaLibrary from 'expo-media-library';

export async function makeCSV() {
  
  const jsonData = `[
    {
        "Column 1": "timestamp",
        "Column 2": "value",
        "Column 3": "intensity"
    }
  ]`;

  const CSV = jsonToCSV(jsonData);

  // Name the File
  const directoryUri = FileSystem.documentDirectory;
  const fileUri = directoryUri + `formData.csv`;
  
  // Ask permission (if not granted)
  const perm = await Permissions.askAsync(Permissions.MEDIA_LIBRARY);
  if (perm.status != 'granted') {
    console.log("Permission not Granted!")
    return;
  }
  
  // Write the file to system
  FileSystem.writeAsStringAsync(fileUri, CSV)
  
  try {
    const asset = await MediaLibrary.createAssetAsync(fileUri);
    const album = await MediaLibrary.getAlbumAsync('forms');
    console.log(album)
    if (album == null) {
      await MediaLibrary.createAlbumAsync('forms', asset, true);
    } else {
      await MediaLibrary.addAssetsToAlbumAsync([asset], album, true);
    }
  } catch (error) {
    console.log(error);
  }

}